name: Lector de Vouchers Telegram

on:
  workflow_dispatch:
  schedule:
    - cron: '1 5 1 * *'

jobs:
  ejecutar-script:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Descargar c√≥digo
        uses: actions/checkout@v3

      - name: üü¢ Instalar Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          cache: 'npm'

      - name: üì¶ Instalar librer√≠as
        run: npm install

      # YA NO CREAMOS EL ARCHIVO F√çSICO JSON AQU√ç
      # Pasamos todo directo a la memoria en el siguiente paso

      - name: üöÄ Ejecutar Bot
        env:
          TELEGRAM_API_ID: ${{ secrets.TELEGRAM_API_ID }}
          TELEGRAM_API_HASH: ${{ secrets.TELEGRAM_API_HASH }}
          TELEGRAM_SESSION: ${{ secrets.TELEGRAM_SESSION }}
          TARGET_CHAT_ID: ${{ secrets.TARGET_CHAT_ID }}
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          SPREADSHEET_ID: ${{ secrets.SPREADSHEET_ID }}
          # ESTA ES LA CLAVE: Pasamos el JSON completo como variable
          GOOGLE_CREDENTIALS_JSON: ${{ secrets.GOOGLE_CREDENTIALS_JSON }}
        run: npx ts-node src/index_clear.ts